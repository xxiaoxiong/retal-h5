import{d as e,r as a,B as s,o as l,$ as t,C as i,D as r,E as o,c as u,w as c,a as n,i as d,e as p,f,g as v,y as _,n as y,j as h,q as b,F as m,k,t as g,G as C,u as $,A,s as w,h as j}from"./index-BWYHzEly.js";import{g as x,p as P,d as I}from"./request.DW5hqJBG.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const B=q(e({__name:"properties",setup(e){const q=a([]),B=a(!0),D=a(!1),E=a(1),F=a(!0),G=a(!1),S=async(e=1,a=!1)=>{a||(B.value=!0);try{const s=await x("/properties",{page:e,limit:10,show_all:!0});let l=[],t=0;if(s&&s.success&&s.properties)l=s.properties,t=s.total||0,F.value=l.length<t;else if(s&&Array.isArray(s))l=s,F.value=s.length>=10;else{if(!(s&&s.data&&Array.isArray(s.data)))return console.error("无法识别的API响应格式:",s),void n({title:"数据格式错误",icon:"none"});l=s.data,F.value=s.data.length>=10}q.value=a?[...q.value,...l]:l}catch(s){console.error("请求房源API出错:",s),n({title:"网络错误，请稍后重试",icon:"none"})}finally{B.value=!1}},z=()=>{console.log("添加新房源"),$({url:"/pages/landlord/property-edit"})},H=(e,a)=>{const s=a?"发布":"下架";A({title:"确认操作",content:`确定要${s}该房源吗？`,success:async l=>{if(l.confirm)try{w({title:"处理中..."});const l=await P(`/properties/${e}/status`,{is_published:a});if(j(),l&&l.success){const l=q.value.find((a=>a.id===e));l&&(l.is_published=a),n({title:`${s}成功`,icon:"success"})}else n({title:`${s}失败`,icon:"error"})}catch(t){j(),console.error(`${s}房源时出错:`,t),n({title:`${s}失败，请重试`,icon:"none"})}}})};return s((()=>{G.value&&(E.value=1,S(),G.value=!1)})),l((()=>{S(),t("refreshProperties",(()=>{"undefined"!=typeof document&&"visible"!==document.visibilityState?G.value=!0:(E.value=1,S())}))})),i((()=>{r("refreshProperties")})),o((()=>{!F.value||B.value||D.value||(D.value=!0,E.value++,S(E.value,!0).finally((()=>{D.value=!1})))})),(e,a)=>{const s=d,l=_,t=y;return p(),u(s,{class:"properties-management-page"},{default:c((()=>[f(s,{class:"header"},{default:c((()=>[f(s,{class:"title"},{default:c((()=>[v("房源管理")])),_:1}),f(l,{onClick:z,class:"add-property-btn"},{default:c((()=>[v("+ 新增房源")])),_:1})])),_:1}),B.value?(p(),u(s,{key:0,class:"loading-placeholder"},{default:c((()=>[f(s,{class:"loading-icon"}),f(t,null,{default:c((()=>[v("正在加载房源数据...")])),_:1})])),_:1})):0===q.value.length?(p(),u(s,{key:1,class:"empty-placeholder"},{default:c((()=>[f(t,{class:"empty-text"},{default:c((()=>[v("您还没有添加任何房源")])),_:1}),f(l,{onClick:z,class:"add-first-property-btn"},{default:c((()=>[v("添加第一个房源")])),_:1})])),_:1})):(p(),u(s,{key:2,class:"properties-list"},{default:c((()=>[(p(!0),h(m,null,k(q.value,(e=>(p(),u(s,{key:e.id,class:"property-item"},{default:c((()=>[f(s,{class:"property-details"},{default:c((()=>[f(s,{class:"property-title"},{default:c((()=>[v(g(e.title),1)])),_:2},1024),f(s,{class:"property-meta"},{default:c((()=>[v(g(e.district)+" | "+g(e.bedrooms)+"室 | "+g(e.price_per_month)+"元/月",1)])),_:2},1024),f(s,{class:"property-status"},{default:c((()=>[f(t,{class:C({"status-published":e.is_published,"status-unpublished":!e.is_published})},{default:c((()=>[v(g(e.is_published?"已发布":"未发布"),1)])),_:2},1032,["class"]),f(t,{class:"status-divider"},{default:c((()=>[v("|")])),_:1}),f(t,{class:C({"status-available":"available"===e.status,"status-unavailable":"available"!==e.status})},{default:c((()=>[v(g("available"===e.status?"可租":"已租"),1)])),_:2},1032,["class"])])),_:2},1024)])),_:2},1024),f(s,{class:"property-actions"},{default:c((()=>[f(l,{onClick:a=>{return s=e.id,void $({url:`/pages/landlord/property-edit?id=${s}`});var s},class:"edit-btn"},{default:c((()=>[v("编辑")])),_:2},1032,["onClick"]),e.is_published?(p(),u(l,{key:0,onClick:a=>H(e.id,!1),class:"unpublish-btn"},{default:c((()=>[v(" 下架 ")])),_:2},1032,["onClick"])):(p(),u(l,{key:1,onClick:a=>H(e.id,!0),class:"publish-btn"},{default:c((()=>[v(" 上架 ")])),_:2},1032,["onClick"])),f(l,{onClick:a=>{return s=e.id,void A({title:"确认删除",content:"删除后无法恢复，确定要删除该房源吗？",success:async e=>{if(e.confirm)try{w({title:"删除中..."});const e=await I(`/properties/${s}`);j(),e&&e.success?(q.value=q.value.filter((e=>e.id!==s)),n({title:"删除成功",icon:"success"})):n({title:"删除失败",icon:"error"})}catch(a){j(),console.error("删除房源时出错:",a),n({title:"删除失败，请重试",icon:"none"})}}});var s},class:"delete-btn"},{default:c((()=>[v("删除")])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)))),128)),D.value?(p(),u(s,{key:0,class:"loading-more"},{default:c((()=>[f(t,null,{default:c((()=>[v("加载更多...")])),_:1})])),_:1})):b("",!0),!F.value&&q.value.length>0?(p(),u(s,{key:1,class:"no-more"},{default:c((()=>[f(t,null,{default:c((()=>[v("--- 已显示全部房源 ---")])),_:1})])),_:1})):b("",!0)])),_:1}))])),_:1})}}}),[["__scopeId","data-v-122f931a"]]);export{B as default};
