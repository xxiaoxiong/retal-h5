import{d as e,r as s,I as a,H as o,o as l,c as r,w as n,i as t,b as d,e as c,f as u,m as i,n as m,g as f,q as p,K as w,t as g,y as _,G as k,X as y,U as v,A as P,a as h,s as T,h as x,W as C,v as F,u as V}from"./index-BWYHzEly.js";import{_ as b}from"./landlord-logo.DjfpHVFB.js";import{b as I}from"./request.DW5hqJBG.js";import{_ as z}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=z(e({__name:"register",setup(e){const z=s(!1),j=s(""),E=s(!1),U=s(!1),q=a({username:"",password:"",confirmPassword:"",agreeTerms:!1}),A=a({username:"",password:"",confirmPassword:"",terms:""}),G=e=>{switch(console.log(`Validating field: ${e}`),e){case"username":q.username?q.username.length<2?A.username="用户名至少需要2个字符":A.username="":A.username="用户名不能为空";break;case"password":q.password?q.password.length<6?A.password="密码至少需要6个字符":A.password="":A.password="密码不能为空",q.confirmPassword&&q.confirmPassword!==q.password?A.confirmPassword="两次输入的密码不一致":q.confirmPassword&&(A.confirmPassword="");break;case"confirmPassword":q.confirmPassword?q.confirmPassword!==q.password?A.confirmPassword="两次输入的密码不一致":A.confirmPassword="":A.confirmPassword="请确认密码"}},H=()=>{console.log("Agreement checked:",q.agreeTerms),A.terms=q.agreeTerms?"":"请同意用户协议和隐私政策"},K=()=>{q.agreeTerms=!q.agreeTerms,console.log("Toggle agreement:",q.agreeTerms),H()};o((()=>{const e=!!(q.username&&q.password&&q.confirmPassword&&q.agreeTerms);return console.log("Form valid:",e,q),e}));const W=()=>{E.value=!E.value},X=()=>{U.value=!U.value},$=()=>{P({title:"用户协议",content:"这里是用户协议内容",showCancel:!1})},B=()=>{P({title:"隐私政策",content:"这里是隐私政策内容",showCancel:!1})},D=async()=>{if(j.value="",G("username"),G("password"),G("confirmPassword"),H(),q.username&&q.password&&q.confirmPassword&&q.agreeTerms)if(A.username||A.password||A.confirmPassword||A.terms)h({title:"请检查填写的信息",icon:"none"});else try{z.value=!0,T({title:"注册中..."}),console.log("尝试注册:",q);const s={username:q.username,password:q.password,role:"landlord"};try{const e=await I("/auth/register",s);console.log("服务器响应:",e),e&&e.success?(x(),h({title:"注册成功",icon:"success",duration:2e3}),e.token?(C("token",e.token),e.user&&C("userInfo",e.user),setTimeout((()=>{F({url:"/pages/index/index",fail(e){console.error("跳转失败:",e),V({url:"/pages/landlord/login"})}})}),2e3)):setTimeout((()=>{V({url:"/pages/landlord/login",success(){h({title:"请使用新账号登录",icon:"none"})}})}),2e3)):(x(),j.value=(null==e?void 0:e.message)||"注册失败，请稍后再试",h({title:j.value,icon:"none"}))}catch(e){console.error("API请求失败:",e),x(),q.username&&q.password?(h({title:"(模拟)注册成功",icon:"success",duration:2e3}),console.log("模拟注册成功，返回登录页"),setTimeout((()=>{V({url:"/pages/landlord/login",success(){h({title:"请使用新注册的账号登录",icon:"none"})}})}),2e3)):(j.value="服务器连接失败，请检查网络",h({title:j.value,icon:"none"}))}}finally{z.value=!1,setTimeout((()=>{x()}),500)}else h({title:"请完善注册信息",icon:"none"})},J=()=>{V({url:"/pages/landlord/login"})};return l((()=>{j.value="",A.username="",A.password="",A.confirmPassword="",A.terms=""})),(e,s)=>{const a=i,o=m,l=t,P=d("uni-icons"),h=w,T=_,x=y;return c(),r(l,{class:"landlord-register-page"},{default:n((()=>[u(l,{class:"register-header"},{default:n((()=>[u(a,{src:b,mode:"aspectFit",class:"logo"}),u(o,{class:"welcome-text"},{default:n((()=>[f("欢迎注册房东账号")])),_:1})])),_:1}),u(l,{class:"register-container"},{default:n((()=>[u(l,{class:"title"},{default:n((()=>[f("账号注册")])),_:1}),u(l,{class:"form-group"},{default:n((()=>[u(l,{class:"form-item"},{default:n((()=>[u(P,{type:"person",size:"20",color:"#409EFF"}),u(h,{type:"text",modelValue:q.username,"onUpdate:modelValue":s[0]||(s[0]=e=>q.username=e),placeholder:"请输入用户名",class:"input",focus:"",onInput:s[1]||(s[1]=e=>G("username"))},null,8,["modelValue"])])),_:1}),A.username?(c(),r(l,{key:0,class:"field-error"},{default:n((()=>[f(g(A.username),1)])),_:1})):p("",!0),u(l,{class:"form-item"},{default:n((()=>[u(P,{type:"locked",size:"20",color:"#409EFF"}),u(h,{type:E.value?"text":"password",modelValue:q.password,"onUpdate:modelValue":s[2]||(s[2]=e=>q.password=e),placeholder:"请设置密码",class:"input",onInput:s[3]||(s[3]=e=>G("password"))},null,8,["type","modelValue"]),u(l,{class:"password-toggle",onClick:W},{default:n((()=>[u(P,{type:E.value?"eye-filled":"eye-slash-filled",size:"20",color:"#909399"},null,8,["type"])])),_:1})])),_:1}),A.password?(c(),r(l,{key:1,class:"field-error"},{default:n((()=>[f(g(A.password),1)])),_:1})):p("",!0),u(l,{class:"form-item"},{default:n((()=>[u(P,{type:"locked",size:"20",color:"#409EFF"}),u(h,{type:U.value?"text":"password",modelValue:q.confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=e=>q.confirmPassword=e),placeholder:"请确认密码",class:"input",onInput:s[5]||(s[5]=e=>G("confirmPassword"))},null,8,["type","modelValue"]),u(l,{class:"password-toggle",onClick:X},{default:n((()=>[u(P,{type:U.value?"eye-filled":"eye-slash-filled",size:"20",color:"#909399"},null,8,["type"])])),_:1})])),_:1}),A.confirmPassword?(c(),r(l,{key:2,class:"field-error"},{default:n((()=>[f(g(A.confirmPassword),1)])),_:1})):p("",!0)])),_:1}),j.value?(c(),r(l,{key:0,class:"error-message"},{default:n((()=>[u(P,{type:"info-filled",size:"14",color:"#F56C6C"}),u(o,null,{default:n((()=>[f(g(j.value),1)])),_:1})])),_:1})):p("",!0),u(T,{class:k(["register-button",{loading:z.value}]),onClick:D,disabled:z.value},{default:n((()=>[u(l,{class:"button-content"},{default:n((()=>[z.value?(c(),r(l,{key:0,class:"loading-spinner"})):p("",!0),u(o,null,{default:n((()=>[f(g(z.value?"注册中":"注册账号"),1)])),_:1})])),_:1})])),_:1},8,["disabled","class"]),u(l,{class:"agreement-text"},{default:n((()=>[u(x,{checked:q.agreeTerms,onClick:K,class:"checkbox",color:"#409EFF"},null,8,["checked"]),u(o,{onClick:K},{default:n((()=>[f("我已阅读并同意 "),u(o,{class:"link",onClick:v($,["stop"])},{default:n((()=>[f("《用户协议》")])),_:1}),f("和"),u(o,{class:"link",onClick:v(B,["stop"])},{default:n((()=>[f("《隐私政策》")])),_:1})])),_:1})])),_:1}),A.terms?(c(),r(l,{key:1,class:"field-error"},{default:n((()=>[f(g(A.terms),1)])),_:1})):p("",!0),u(l,{class:"extra-links"},{default:n((()=>[u(o,{onClick:J},{default:n((()=>[f("已有账号? 返回登录")])),_:1})])),_:1})])),_:1}),u(l,{class:"footer"},{default:n((()=>[u(o,null,{default:n((()=>[f("智慧租房平台 © 2023")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-d66cfaa6"]]);export{j as default};
