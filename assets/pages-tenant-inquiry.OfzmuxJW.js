import{d as e,r as l,I as a,x as t,z as s,H as o,c as n,w as c,i as u,b as i,e as r,f as d,q as p,n as f,g as m,j as _,F as y,k as g,G as h,t as v,K as b,L as k,m as w,y as x,N as C,a0 as V,a as q,s as z,h as I,J as D,u as U}from"./index-BWYHzEly.js";import{u as j,b as R}from"./request.DW5hqJBG.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const P=F(e({__name:"inquiry",setup(e){const F=[{label:"租金问题",value:"rent",icon:"wallet"},{label:"设施维修",value:"repair",icon:"wrench"},{label:"合同咨询",value:"contract",icon:"file-text"},{label:"其他问题",value:"other",icon:"help"}],P=l(!1);P.value=window.location.hostname.includes("localhost")||window.location.hostname.includes("127.0.0.1")||window.location.hostname.includes(".local");const B=a({type:"rent",title:"",content:"",images:[],contact:""}),L=l(""),M=l(!1),T=l(""),A=l(P.value?"开发提示: 请确保已在Supabase中执行db/storage_setup.sql脚本创建存储桶，以便上传图片功能正常工作。":"");t((e=>{if(e&&e.property_id)L.value=e.property_id,console.log("从URL参数获取房源ID:",L.value);else{const e=s("current_property_id");if(e)L.value=e,console.log("从缓存获取房源ID:",L.value);else{try{const e=s("userInfo")||{};e.currentRental&&e.currentRental.property_id&&(L.value=e.currentRental.property_id,console.log("从用户信息获取房源ID:",L.value))}catch(l){console.error("获取用户租房信息失败",l)}!L.value&&P.value&&(L.value="1594a252-1c48-473b-81c5-1a162872021b",console.warn("使用测试用的房源ID:",L.value))}}}));const E=o((()=>B.type&&""!==B.title.trim()&&""!==B.content.trim()&&""!==B.contact.trim())),G=()=>{C({count:3-B.images.length,sizeType:["compressed"],sourceType:["album","camera"],success:e=>{const l=e.tempFilePaths,a=[];l.forEach((e=>{V({filePath:e,success:l=>{l.size/1024/1024<=10?B.images.push(e):a.push(e)}})})),a.length>0&&q({title:"部分图片超过10MB限制，已被过滤",icon:"none"})}})},H=async()=>{if(E.value)if(L.value)try{M.value=!0;let a=[];if(B.images.length>0){z({title:"正在上传图片..."});try{for(const e of B.images){const l=await j("/tenant/upload-image",e,{type:"inquiry"},"image");l&&l.imageUrl&&a.push(l.imageUrl)}I()}catch(e){I(),q({title:"图片上传失败",icon:"none"}),console.error("图片上传失败:",e)}}const t={property_id:L.value,type:B.type,title:B.title,content:B.content,contact:B.contact,images:a};z({title:"提交中..."});try{await R("/tenant/inquiry/submit",t);I(),q({title:"咨询提交成功",icon:"success",duration:2e3}),B.title="",B.content="",B.images=[],B.contact=""}catch(l){console.error("API请求失败:",l),I(),T.value=l.message||"服务器连接失败，请稍后再试",q({title:T.value,icon:"none"})}}finally{M.value=!1}else q({title:"无法确定当前房源，请返回重试",icon:"none"});else q({title:"请完善表单信息",icon:"none"})},J=()=>{D()};return(e,l)=>{const a=i("uni-icons"),t=f,s=u,o=b,C=k,V=w,q=x;return r(),n(s,{class:"tenant-inquiry-page"},{default:c((()=>[d(s,{class:"page-header"},{default:c((()=>[d(s,{class:"header-title"},{default:c((()=>[d(a,{type:"help",size:"24",color:"#4CD964"}),d(t,null,{default:c((()=>[m("提交咨询")])),_:1})])),_:1}),d(t,{class:"header-subtitle"},{default:c((()=>[m("您可以向管理员提交任何关于租房的问题或咨询")])),_:1})])),_:1}),d(s,{class:"form-container"},{default:c((()=>[d(s,{class:"form-group"},{default:c((()=>[d(s,{class:"form-label"},{default:c((()=>[m("咨询类型")])),_:1}),d(s,{class:"type-selection"},{default:c((()=>[(r(),_(y,null,g(F,((e,l)=>d(s,{key:l,class:h(["type-item",{active:B.type===e.value}]),onClick:l=>B.type=e.value},{default:c((()=>[d(a,{type:e.icon,size:"20",color:B.type===e.value?"#fff":"#333"},null,8,["type","color"]),d(t,null,{default:c((()=>[m(v(e.label),1)])),_:2},1024)])),_:2},1032,["class","onClick"]))),64))])),_:1})])),_:1}),d(s,{class:"form-group"},{default:c((()=>[d(s,{class:"form-label"},{default:c((()=>[m("咨询标题")])),_:1}),d(s,{class:"form-input"},{default:c((()=>[d(o,{type:"text",modelValue:B.title,"onUpdate:modelValue":l[0]||(l[0]=e=>B.title=e),placeholder:"请简要描述您的问题",maxlength:"50"},null,8,["modelValue"]),d(t,{class:"input-counter"},{default:c((()=>[m(v(B.title.length)+"/50",1)])),_:1})])),_:1})])),_:1}),d(s,{class:"form-group"},{default:c((()=>[d(s,{class:"form-label"},{default:c((()=>[m("详细描述")])),_:1}),d(s,{class:"form-textarea"},{default:c((()=>[d(C,{modelValue:B.content,"onUpdate:modelValue":l[1]||(l[1]=e=>B.content=e),placeholder:"请详细描述您的问题，以便我们更好地为您解答",maxlength:"500","auto-height":""},null,8,["modelValue"]),d(t,{class:"input-counter"},{default:c((()=>[m(v(B.content.length)+"/500",1)])),_:1})])),_:1})])),_:1}),d(s,{class:"form-group"},{default:c((()=>[d(s,{class:"form-label"},{default:c((()=>[m("相关图片 (选填)")])),_:1}),d(s,{class:"upload-section"},{default:c((()=>[d(s,{class:"image-list"},{default:c((()=>[(r(!0),_(y,null,g(B.images,((e,l)=>(r(),n(s,{key:l,class:"image-item"},{default:c((()=>[d(V,{src:e,mode:"aspectFill"},null,8,["src"]),d(s,{class:"delete-image",onClick:e=>(e=>{B.images.splice(e,1)})(l)},{default:c((()=>[d(a,{type:"closeempty",size:"20",color:"#fff"})])),_:2},1032,["onClick"])])),_:2},1024)))),128)),B.images.length<3?(r(),n(s,{key:0,class:"upload-button",onClick:G},{default:c((()=>[d(a,{type:"camera",size:"24",color:"#999"}),d(t,null,{default:c((()=>[m("上传图片")])),_:1})])),_:1})):p("",!0)])),_:1}),d(t,{class:"image-tip"},{default:c((()=>[m("最多上传3张图片，每张不超过10MB")])),_:1})])),_:1})])),_:1}),d(s,{class:"form-group"},{default:c((()=>[d(s,{class:"form-label"},{default:c((()=>[m("联系方式")])),_:1}),d(s,{class:"form-input"},{default:c((()=>[d(o,{type:"text",modelValue:B.contact,"onUpdate:modelValue":l[2]||(l[2]=e=>B.contact=e),placeholder:"请填写您的手机号码或其他联系方式"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),d(s,{class:"form-actions"},{default:c((()=>[d(q,{class:h(["submit-button",{disabled:!E.value}]),onClick:H,disabled:!E.value||M.value},{default:c((()=>[d(s,{class:"button-content"},{default:c((()=>[M.value?(r(),n(s,{key:0,class:"loading-spinner"})):p("",!0),d(t,null,{default:c((()=>[m(v(M.value?"提交中...":"提交咨询"),1)])),_:1})])),_:1})])),_:1},8,["class","disabled"]),d(q,{class:"cancel-button",onClick:J},{default:c((()=>[m("取消")])),_:1})])),_:1}),d(s,{class:"history-link",onClick:l[3]||(l[3]=e=>{U({url:"/pages/tenant/inquiry-history"})})},{default:c((()=>[d(a,{type:"list",size:"16",color:"#4CD964"}),d(t,null,{default:c((()=>[m("查看历史咨询")])),_:1})])),_:1}),P.value?(r(),n(s,{key:0,class:"setup-note"},{default:c((()=>[m(v(A.value),1)])),_:1})):p("",!0)])),_:1})}}}),[["__scopeId","data-v-a2b9fdc3"]]);export{P as default};
