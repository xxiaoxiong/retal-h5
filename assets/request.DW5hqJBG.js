import{O as t,V as e,r as a,z as n,a2 as o,a3 as s,a as r,u,a4 as i}from"./index-BWYHzEly.js";const l="http://localhost:3000/api",c=a(!1),d=a(null);function h(){var a;try{const e=t();if(e&&e.length>0){const t=e[e.length-1],n=t.options||(null==(a=t.$page)?void 0:a.options);if(n&&"object"==typeof n)return n}}catch(n){}try{const t=e();if(t&&t.query)return t.query}catch(n){}return{}}async function f(t,e={}){return c.value=!0,d.value=null,new Promise(((a,i)=>{const h=n("token"),f=t.startsWith("http")?t:`${l}${t}`;o({url:f,method:e.method||"GET",data:e.data||{},header:{"Content-Type":"application/json",...h?{Authorization:`Bearer ${h}`}:{},...e.header},success:t=>{var e;if(t.statusCode>=200&&t.statusCode<300)a(t.data);else if(401===t.statusCode)s("token"),r({title:"登录已过期，请重新登录",icon:"none",duration:2e3}),setTimeout((()=>{u({url:"/pages/landlord/login"})}),1500),i(new Error("认证失败"));else{const a=(null==(e=t.data)?void 0:e.message)||`请求失败: ${t.statusCode}`;d.value=a,i(new Error(a))}},fail:t=>{const e=t.errMsg||"网络请求失败";d.value=e,i(new Error(e))},complete:()=>{c.value=!1}})}))}function p(t,e={},a={}){let n=t;if(Object.keys(e).length>0){const a=Object.entries(e).map((([t,e])=>`${encodeURIComponent(t)}=${encodeURIComponent(String(e))}`)).join("&");n=`${t}${t.includes("?")?"&":"?"}${a}`}return f(n,{method:"GET",...a})}function m(t,e={},a={}){return f(t,{method:"POST",data:e,...a})}function v(t,e={},a={}){return f(t,{method:"PUT",data:e,...a})}function $(t,e={}){return f(t,{method:"DELETE",...e})}function g(t,e,a={},o="file"){return c.value=!0,d.value=null,new Promise(((s,r)=>{const u=n("token"),h=t.startsWith("http")?t:`${l}${t}`;i({url:h,filePath:e,name:o,formData:a,header:{...u?{Authorization:`Bearer ${u}`}:{}},success:t=>{if(t.statusCode>=200&&t.statusCode<300)try{const e=JSON.parse(t.data);s(e)}catch(e){s(t.data)}else{const e=`上传失败: ${t.statusCode}`;d.value=e,r(new Error(e))}},fail:t=>{const e=t.errMsg||"上传失败";d.value=e,r(new Error(e))},complete:()=>{c.value=!1}})}))}export{h as a,m as b,$ as d,p as g,v as p,g as u};
