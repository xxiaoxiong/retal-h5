import{d as e,r as a,o as t,z as l,a as s,Q as n,c as r,w as i,i as o,e as u,f as c,g as d,j as v,q as p,F as _,k as f,n as g,t as m,m as y,u as q}from"./index-BWYHzEly.js";import{g as $}from"./request.DW5hqJBG.js";import{_ as h}from"./_plugin-vue_export-helper.BCo6x5W8.js";const k=h(e({__name:"inquiries",setup(e){const h=a([]),k=a(!0),w=a(!1),S=a(!0),j=a(1),D=async(e=1)=>{1===e?(k.value=!0,h.value=[]):w.value=!0,console.log(`正在获取咨询记录: page=${e}, pageSize=10`);try{const a=await $("/inquiries",{page:e,limit:10});if(a&&a.success){const t=a.data||[];h.value=1===e?t:[...h.value,...t],S.value=10===t.length}else console.error("获取咨询记录失败:",a),s({title:"加载咨询记录失败",icon:"none"})}catch(a){console.error("获取咨询记录错误:",a),s({title:"网络错误",icon:"none"});{await new Promise((e=>setTimeout(e,800)));const a=Array.from({length:10}).map(((e,a)=>({id:`inq_${a+1}`,created_at:new Date(Date.now()-36e5*a).toISOString(),tenant:{id:"tenant_"+(a%5+1),nickname:"租客"+(a%5+1),avatar_url:`/static/avatar${a%5+1}.png`},property:a%3==0?void 0:{id:"prop_"+(a%7+1),title:"示例房源 "+(a%7+1)},question:`这是一个示例咨询问题 ${a+1}，关于${a%3==0?"通用问题":"特定房源"}的咨询。`,ai_response:`这是系统回复 ${a+1}，提供了关于${a%3==0?"通用问题":"特定房源"}的详细信息和建议。`})));h.value=1===e?a:[...h.value,...a],S.value=e<3}}finally{1===e?k.value=!1:w.value=!1}},x=e=>{const a=new Date(e);return`${a.getMonth()+1}月${a.getDate()}日 ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`};t((()=>{const e=l("userInfo");if(!e||"landlord"!==e.role)return s({title:"请先登录房东账号",icon:"none"}),void setTimeout((()=>{n({url:"/pages/landlord/login"})}),1500);D()}));const I=()=>{S.value&&!w.value&&S.value&&!w.value&&(j.value++,D(j.value))};return(e,a)=>{const t=o,l=g,s=y;return u(),r(t,{class:"inquiries-list-page"},{default:i((()=>[c(t,{class:"header"},{default:i((()=>[c(t,{class:"title"},{default:i((()=>[d("咨询记录")])),_:1})])),_:1}),k.value&&0===h.value.length?(u(),r(t,{key:0,class:"loading-placeholder"},{default:i((()=>[d("加载中...")])),_:1})):0===h.value.length?(u(),r(t,{key:1,class:"empty-placeholder"},{default:i((()=>[d("暂无咨询记录")])),_:1})):(u(),r(t,{key:2,class:"inquiries-list",onScrolltolower:I},{default:i((()=>[(u(!0),v(_,null,f(h.value,(e=>(u(),r(t,{key:e.id,class:"inquiry-item",onClick:a=>{return t=e.id,console.log(`View inquiry detail: ${t}`),void q({url:`/pages/landlord/inquiry-detail?id=${t}`});var t}},{default:i((()=>[c(t,{class:"inquiry-header"},{default:i((()=>[c(t,{class:"property-info"},{default:i((()=>[c(l,{class:"property-name"},{default:i((()=>{var a;return[d(m((null==(a=e.property)?void 0:a.title)||"通用咨询"),1)]})),_:2},1024)])),_:2},1024),c(t,{class:"time"},{default:i((()=>[d(m(x(e.created_at)),1)])),_:2},1024)])),_:2},1024),c(t,{class:"inquiry-content"},{default:i((()=>[c(t,{class:"question"},{default:i((()=>[d(m(e.question),1)])),_:2},1024),c(t,{class:"answer"},{default:i((()=>[d(m(e.ai_response),1)])),_:2},1024)])),_:2},1024),c(t,{class:"inquiry-footer"},{default:i((()=>[c(t,{class:"tenant-info"},{default:i((()=>{var a;return[c(s,{class:"avatar",src:(null==(a=e.tenant)?void 0:a.avatar_url)||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),c(l,{class:"name"},{default:i((()=>{var a;return[d(m((null==(a=e.tenant)?void 0:a.nickname)||"匿名用户"),1)]})),_:2},1024)]})),_:2},1024),c(t,{class:"status-tag"},{default:i((()=>[d(m(e.property?"房源咨询":"通用咨询"),1)])),_:2},1024)])),_:2},1024)])),_:2},1032,["onClick"])))),128)),w.value?(u(),r(t,{key:0,class:"loading-more"},{default:i((()=>[d("加载中...")])),_:1})):p("",!0),S.value?p("",!0):(u(),r(t,{key:1,class:"no-more"},{default:i((()=>[d("没有更多了")])),_:1}))])),_:1}))])),_:1})}}}),[["__scopeId","data-v-1424901f"]]);export{k as default};
