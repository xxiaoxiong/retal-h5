import{d as e,r as a,H as l,x as t,c as s,w as u,a as o,i as n,e as r,f as c,g as d,t as i,M as v,G as p,n as f,q as m,K as _,L as g,y,s as b,h,Q as k,J as D}from"./index-BWYHzEly.js";import{g as $,b as w}from"./request.DW5hqJBG.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=x(e({__name:"appointment",setup(e){const x=a(""),V=a(null),q=a(!0),S=a(""),j=a(""),C=a(""),I=a(""),M=a(""),U=l((()=>!!S.value&&!!j.value&&!!C.value&&""===M.value)),B=l((()=>G(new Date))),F=l((()=>{const e=new Date,a=new Date(e);return a.setDate(e.getDate()+30),G(a)})),G=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,H=e=>{S.value=e.detail.value},J=e=>{j.value=e.detail.value},K=async()=>{var e;if(L(),U.value)try{b({title:"提交中..."});const a=`${S.value}T${j.value}:00`,l=await w("/appointments",{property_id:x.value,appointment_time:a,phone_number:C.value,notes:I.value});if(h(),l&&l.success){o({title:"预约已提交",icon:"success",duration:2e3});const a=(null==(e=l.data)?void 0:e.id)||"";k({url:`/pages/booking/index?from=new_appointment&id=${a}`,success:()=>{console.log("跳转到预约列表页面成功")},fail:e=>{console.error("跳转失败:",e),D()}})}else o({title:(null==l?void 0:l.message)||"预约失败",icon:"none"})}catch(a){h(),console.error("提交预约失败:",a),o({title:"预约失败，请重试",icon:"none"})}else o({title:M.value||"请填写完整信息",icon:"none"})};t((e=>{e&&e.property_id&&(x.value=e.property_id,(async()=>{if(x.value){q.value=!0;try{console.log(`正在获取房源ID: ${x.value} 的详情`);const e=await $(`/properties/public/${x.value}`);console.log("获取房源详情返回:",e),e&&e.success&&e.property?V.value=e.property:e&&e.data?V.value=e.data:o({title:"获取房源信息失败",icon:"none"})}catch(e){console.error("获取房源详情失败:",e),o({title:"获取房源信息失败",icon:"none"})}finally{q.value=!1}}})());const a=new Date;a.setDate(a.getDate()+1),S.value=G(a),j.value="10:00"}));const L=()=>{C.value?/^1\d{10}$/.test(C.value)?M.value="":M.value="请输入有效的11位手机号码":M.value="请输入联系电话"};return(e,a)=>{const l=n,t=f,o=v,b=_,h=g,k=y;return r(),s(l,{class:"appointment-page"},{default:u((()=>[c(l,{class:"header"},{default:u((()=>[c(l,{class:"title"},{default:u((()=>[d("预约看房")])),_:1})])),_:1}),q.value?(r(),s(l,{key:0,class:"loading"},{default:u((()=>[d("加载中...")])),_:1})):V.value?(r(),s(l,{key:2,class:"form-container"},{default:u((()=>[c(l,{class:"property-info"},{default:u((()=>[c(l,{class:"property-title"},{default:u((()=>[d(i(V.value.title),1)])),_:1}),c(l,{class:"property-meta"},{default:u((()=>[d(i(V.value.district)+" | "+i(V.value.bedrooms)+"室 | "+i(V.value.price_per_month)+"元/月",1)])),_:1})])),_:1}),c(l,{class:"form-section"},{default:u((()=>[c(l,{class:"form-item"},{default:u((()=>[c(l,{class:"label required"},{default:u((()=>[d("预约日期")])),_:1}),c(o,{mode:"date",value:S.value,start:B.value,end:F.value,onChange:H},{default:u((()=>[c(l,{class:p(["picker-value",{"has-value":S.value}])},{default:u((()=>[d(i(S.value||"请选择日期")+" ",1),c(t,{class:"picker-icon"},{default:u((()=>[d("▼")])),_:1})])),_:1},8,["class"])])),_:1},8,["value","start","end"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(l,{class:"label required"},{default:u((()=>[d("预约时间")])),_:1}),c(o,{mode:"time",value:j.value,start:"09:00",end:"18:00",onChange:J},{default:u((()=>[c(l,{class:p(["picker-value",{"has-value":j.value}])},{default:u((()=>[d(i(j.value||"请选择时间")+" ",1),c(t,{class:"picker-icon"},{default:u((()=>[d("▼")])),_:1})])),_:1},8,["class"])])),_:1},8,["value"])])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(l,{class:"label required"},{default:u((()=>[d("联系电话")])),_:1}),c(b,{type:"number",modelValue:C.value,"onUpdate:modelValue":a[0]||(a[0]=e=>C.value=e),placeholder:"请输入您的联系电话",maxlength:"11",onBlur:L},null,8,["modelValue"]),M.value?(r(),s(l,{key:0,class:"error-tip"},{default:u((()=>[d(i(M.value),1)])),_:1})):m("",!0)])),_:1}),c(l,{class:"form-item"},{default:u((()=>[c(l,{class:"label"},{default:u((()=>[d("备注信息")])),_:1}),c(h,{modelValue:I.value,"onUpdate:modelValue":a[1]||(a[1]=e=>I.value=e),placeholder:"可以填写您的其他要求或问题"},null,8,["modelValue"])])),_:1})])),_:1}),c(k,{onClick:K,class:"submit-btn",disabled:!U.value},{default:u((()=>[d(" 提交预约 ")])),_:1},8,["disabled"])])),_:1})):(r(),s(l,{key:1,class:"error"},{default:u((()=>[d("未找到房源信息")])),_:1}))])),_:1})}}}),[["__scopeId","data-v-bc16d9d7"]]);export{V as default};
