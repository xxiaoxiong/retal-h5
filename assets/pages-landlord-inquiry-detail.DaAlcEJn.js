import{d as e,r as a,o as t,V as s,a as l,c as n,w as u,i as r,b as i,e as c,f as o,g as d,t as _,m as v,n as p,q as f,j as m,F as y,k as g,L as q,y as h,J as k}from"./index-BWYHzEly.js";import{g as w,b as S}from"./request.DW5hqJBG.js";import{_ as b}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=b(e({__name:"inquiry-detail",setup(e){const b=a(""),$=a(!0),D=a(!1),x=a(""),I=a(null),j=a([]),V=async()=>{try{const e=await w(`/inquiries/${b.value}/replies`);e&&e.success&&e.data?j.value=e.data:console.error("获取回复列表失败:",e)}catch(e){console.error("获取回复列表错误:",e)}},O=async()=>{if(x.value.trim()){D.value=!0;try{const e={inquiry_id:b.value,content:x.value.trim()},a=await S(`/inquiries/${b.value}/reply`,e);a&&a.success?(l({title:"回复成功",icon:"success"}),j.value.push({id:`reply_${Date.now()}`,inquiry_id:b.value,content:x.value.trim(),created_at:(new Date).toISOString(),sender_type:"landlord"}),x.value=""):l({title:"回复失败",icon:"none"})}catch(e){console.error("发送回复失败:",e),l({title:"网络错误",icon:"none"}),j.value.push({id:`reply_${Date.now()}`,inquiry_id:b.value,content:x.value.trim(),created_at:(new Date).toISOString(),sender_type:"landlord"}),x.value="",l({title:"模拟回复成功",icon:"success"})}finally{D.value=!1}}else l({title:"请输入回复内容",icon:"none"})},C=e=>{const a=new Date(e);return`${a.getMonth()+1}月${a.getDate()}日 ${a.getHours().toString().padStart(2,"0")}:${a.getMinutes().toString().padStart(2,"0")}`},F=()=>{k()};return t((()=>{const e=s().query;e&&e.id?(b.value=e.id,(async()=>{if(b.value){$.value=!0;try{const e=await w(`/inquiries/${b.value}`);e&&e.success&&e.data?(I.value=e.data,await V()):(l({title:"获取咨询详情失败",icon:"none"}),setTimeout((()=>{I.value={id:b.value,created_at:(new Date).toISOString(),tenant:{id:"tenant_1",nickname:"测试租客",avatar_url:"/static/avatar1.png"},property:{id:"prop_1",title:"示例房源名称"},question:"您好，我想咨询一下这套房源的具体位置和周边环境，以及是否能够短期租住？",ai_response:"您好，关于这套房源的位置在城市中心区域，周边有购物中心、医院和公园。根据房东设置，该房源支持最短3个月的租期。如果您有更具体的问题，房东看到后会进一步回复您。"},j.value=[],$.value=!1}),500))}catch(e){console.error("获取咨询详情失败:",e),l({title:"网络错误",icon:"none"})}finally{$.value=!1}}})()):($.value=!1,l({title:"未指定咨询ID",icon:"none"}))})),(e,a)=>{const t=i("uni-icons"),s=r,l=v,k=p,w=q,S=h;return c(),n(s,{class:"inquiry-detail-page"},{default:u((()=>[o(s,{class:"header"},{default:u((()=>[o(s,{class:"back-button",onClick:F},{default:u((()=>[o(t,{type:"back",size:"20",color:"#333"})])),_:1}),o(s,{class:"title"},{default:u((()=>[d("咨询详情")])),_:1})])),_:1}),$.value?(c(),n(s,{key:0,class:"loading-placeholder"},{default:u((()=>[d("加载中...")])),_:1})):I.value?(c(),n(s,{key:2,class:"inquiry-content"},{default:u((()=>[o(s,{class:"inquiry-header"},{default:u((()=>[I.value.property?(c(),n(s,{key:0,class:"property-info"},{default:u((()=>[o(s,{class:"property-title"},{default:u((()=>{var e;return[d(_(null==(e=I.value.property)?void 0:e.title),1)]})),_:1}),o(s,{class:"inquiry-time"},{default:u((()=>[d(_(C(I.value.created_at)),1)])),_:1})])),_:1})):(c(),n(s,{key:1,class:"property-info"},{default:u((()=>[o(s,{class:"property-title"},{default:u((()=>[d("通用咨询")])),_:1}),o(s,{class:"inquiry-time"},{default:u((()=>[d(_(C(I.value.created_at)),1)])),_:1})])),_:1})),o(s,{class:"tenant-info"},{default:u((()=>{var e;return[o(l,{class:"avatar",src:(null==(e=I.value.tenant)?void 0:e.avatar_url)||"/static/default-avatar.png",mode:"aspectFill"},null,8,["src"]),o(k,{class:"tenant-name"},{default:u((()=>{var e;return[d(_((null==(e=I.value.tenant)?void 0:e.nickname)||"匿名用户"),1)]})),_:1})]})),_:1})])),_:1}),o(s,{class:"message-container"},{default:u((()=>[o(s,{class:"message tenant-message"},{default:u((()=>[o(s,{class:"message-content"},{default:u((()=>[o(k,{class:"message-text"},{default:u((()=>[d(_(I.value.question),1)])),_:1}),o(k,{class:"message-time"},{default:u((()=>[d(_(C(I.value.created_at)),1)])),_:1})])),_:1})])),_:1}),I.value.ai_response?(c(),n(s,{key:0,class:"message ai-message"},{default:u((()=>[o(s,{class:"message-content"},{default:u((()=>[o(s,{class:"message-sender"},{default:u((()=>[d("AI助手")])),_:1}),o(k,{class:"message-text"},{default:u((()=>[d(_(I.value.ai_response),1)])),_:1}),o(k,{class:"message-time"},{default:u((()=>[d(_(C(I.value.created_at)),1)])),_:1})])),_:1})])),_:1})):f("",!0),(c(!0),m(y,null,g(j.value,((e,a)=>(c(),n(s,{class:"message landlord-message",key:a},{default:u((()=>[o(s,{class:"message-content"},{default:u((()=>[o(s,{class:"message-sender"},{default:u((()=>[d("我的回复")])),_:1}),o(k,{class:"message-text"},{default:u((()=>[d(_(e.content),1)])),_:2},1024),o(k,{class:"message-time"},{default:u((()=>[d(_(C(e.created_at)),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)))),128))])),_:1}),o(s,{class:"reply-container"},{default:u((()=>[o(w,{modelValue:x.value,"onUpdate:modelValue":a[0]||(a[0]=e=>x.value=e),class:"reply-input",placeholder:"输入回复内容...","auto-height":""},null,8,["modelValue"]),o(s,{class:"reply-actions"},{default:u((()=>[o(S,{class:"reply-button",onClick:O,disabled:!x.value.trim()||D.value},{default:u((()=>[d(_(D.value?"发送中...":"回复"),1)])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})):(c(),n(s,{key:1,class:"empty-placeholder"},{default:u((()=>[d("未找到咨询记录")])),_:1}))])),_:1})}}}),[["__scopeId","data-v-865b1cdf"]]);export{$ as default};
