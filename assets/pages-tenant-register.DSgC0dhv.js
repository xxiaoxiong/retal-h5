import{d as e,r as s,I as a,H as o,o as l,c as r,w as n,i as t,b as c,e as u,f as d,m as i,n as m,g as p,q as f,K as w,t as g,y as h,G as _,X as y,U as k,A as v,a as P,s as C,h as T,W as V,v as b,J as x,u as I}from"./index-BWYHzEly.js";import{_ as z}from"./tenant-logo.B_ubGxOA.js";import{b as D}from"./request.DW5hqJBG.js";import{_ as U}from"./_plugin-vue_export-helper.BCo6x5W8.js";const j=U(e({__name:"register",setup(e){const U=s(!1),j=s(""),A=s(!1),F=s(!1),q=a({username:"",password:"",confirmPassword:"",phone:"",agreeTerms:!1}),$=a({username:"",password:"",confirmPassword:"",phone:"",terms:""}),G=e=>{switch(console.log(`Validating field: ${e}`),e){case"username":q.username?q.username.length<2?$.username="用户名至少需要2个字符":$.username="":$.username="用户名不能为空";break;case"password":q.password?q.password.length<6?$.password="密码至少需要6个字符":$.password="":$.password="密码不能为空",q.confirmPassword&&q.confirmPassword!==q.password?$.confirmPassword="两次输入的密码不一致":q.confirmPassword&&($.confirmPassword="");break;case"confirmPassword":q.confirmPassword?q.confirmPassword!==q.password?$.confirmPassword="两次输入的密码不一致":$.confirmPassword="":$.confirmPassword="请确认密码";break;case"phone":q.phone?/^1[3-9]\d{9}$/.test(q.phone)?$.phone="":$.phone="请输入有效的手机号":$.phone="手机号不能为空"}},H=()=>{console.log("Agreement checked:",q.agreeTerms),$.terms=q.agreeTerms?"":"请同意用户协议和隐私政策"},J=()=>{q.agreeTerms=!q.agreeTerms,console.log("Toggle agreement:",q.agreeTerms),H()};o((()=>{const e=!!(q.username&&q.password&&q.confirmPassword&&q.phone&&q.agreeTerms);return console.log("Form valid:",e,q),e}));const K=()=>{A.value=!A.value},M=()=>{F.value=!F.value},W=()=>{v({title:"用户协议",content:"这里是用户协议内容",showCancel:!1})},X=()=>{v({title:"隐私政策",content:"这里是隐私政策内容",showCancel:!1})},B=async()=>{if(j.value="",G("username"),G("password"),G("confirmPassword"),G("phone"),H(),q.username&&q.password&&q.confirmPassword&&q.phone&&q.agreeTerms)if($.username||$.password||$.confirmPassword||$.phone||$.terms)P({title:"请检查填写的信息",icon:"none"});else try{U.value=!0,C({title:"注册中..."}),console.log("尝试注册:",q);const s={username:q.username,password:q.password,phone:q.phone,role:"tenant"};try{const e=await D("/auth/register",s);console.log("服务器响应:",e),e&&e.success?(T(),P({title:"注册成功",icon:"success",duration:2e3}),e.token?(V("token",e.token),e.user&&V("userInfo",e.user),setTimeout((()=>{b({url:"/pages/tenant/home",success(){console.log("成功跳转到租户主页")},fail(e){console.error("跳转失败:",e),P({title:"跳转失败: "+e.errMsg,icon:"none"}),setTimeout((()=>{x()}),1500)}})}),2e3)):setTimeout((()=>{I({url:"/pages/tenant/login",success(){P({title:"请使用新账号登录",icon:"none"})}})}),2e3)):(T(),j.value=(null==e?void 0:e.message)||"注册失败，请稍后再试",P({title:j.value,icon:"none"}))}catch(e){console.error("API请求失败:",e),T(),q.username&&q.password?(P({title:"(模拟)注册成功",icon:"success",duration:2e3}),console.log("模拟注册成功，返回登录页"),setTimeout((()=>{I({url:"/pages/tenant/login",success(){P({title:"请使用新注册的账号登录",icon:"none"})}})}),2e3)):(j.value="服务器连接失败，请检查网络",P({title:j.value,icon:"none"}))}}finally{U.value=!1,setTimeout((()=>{T()}),500)}else P({title:"请完善注册信息",icon:"none"})},E=()=>{I({url:"/pages/tenant/login"})};return l((()=>{j.value="",$.username="",$.password="",$.confirmPassword="",$.phone="",$.terms=""})),(e,s)=>{const a=i,o=m,l=t,v=c("uni-icons"),P=w,C=h,T=y;return u(),r(l,{class:"tenant-register-page"},{default:n((()=>[d(l,{class:"register-header"},{default:n((()=>[d(a,{src:z,mode:"aspectFit",class:"logo"}),d(o,{class:"welcome-text"},{default:n((()=>[p("欢迎注册租户账号")])),_:1})])),_:1}),d(l,{class:"register-container"},{default:n((()=>[d(l,{class:"title"},{default:n((()=>[p("账号注册")])),_:1}),d(l,{class:"form-group"},{default:n((()=>[d(l,{class:"form-item"},{default:n((()=>[d(v,{type:"person",size:"20",color:"#4CD964"}),d(P,{type:"text",modelValue:q.username,"onUpdate:modelValue":s[0]||(s[0]=e=>q.username=e),placeholder:"请输入用户名",class:"input",focus:"",onInput:s[1]||(s[1]=e=>G("username"))},null,8,["modelValue"])])),_:1}),$.username?(u(),r(l,{key:0,class:"field-error"},{default:n((()=>[p(g($.username),1)])),_:1})):f("",!0),d(l,{class:"form-item"},{default:n((()=>[d(v,{type:"locked",size:"20",color:"#4CD964"}),d(P,{type:A.value?"text":"password",modelValue:q.password,"onUpdate:modelValue":s[2]||(s[2]=e=>q.password=e),placeholder:"请设置密码",class:"input",onInput:s[3]||(s[3]=e=>G("password"))},null,8,["type","modelValue"]),d(l,{class:"password-toggle",onClick:K},{default:n((()=>[d(v,{type:A.value?"eye-filled":"eye-slash-filled",size:"20",color:"#909399"},null,8,["type"])])),_:1})])),_:1}),$.password?(u(),r(l,{key:1,class:"field-error"},{default:n((()=>[p(g($.password),1)])),_:1})):f("",!0),d(l,{class:"form-item"},{default:n((()=>[d(v,{type:"locked",size:"20",color:"#4CD964"}),d(P,{type:F.value?"text":"password",modelValue:q.confirmPassword,"onUpdate:modelValue":s[4]||(s[4]=e=>q.confirmPassword=e),placeholder:"请确认密码",class:"input",onInput:s[5]||(s[5]=e=>G("confirmPassword"))},null,8,["type","modelValue"]),d(l,{class:"password-toggle",onClick:M},{default:n((()=>[d(v,{type:F.value?"eye-filled":"eye-slash-filled",size:"20",color:"#909399"},null,8,["type"])])),_:1})])),_:1}),$.confirmPassword?(u(),r(l,{key:2,class:"field-error"},{default:n((()=>[p(g($.confirmPassword),1)])),_:1})):f("",!0),d(l,{class:"form-item"},{default:n((()=>[d(v,{type:"phone",size:"20",color:"#4CD964"}),d(P,{type:"number",modelValue:q.phone,"onUpdate:modelValue":s[6]||(s[6]=e=>q.phone=e),placeholder:"请输入手机号",class:"input",onInput:s[7]||(s[7]=e=>G("phone"))},null,8,["modelValue"])])),_:1}),$.phone?(u(),r(l,{key:3,class:"field-error"},{default:n((()=>[p(g($.phone),1)])),_:1})):f("",!0)])),_:1}),j.value?(u(),r(l,{key:0,class:"error-message"},{default:n((()=>[d(v,{type:"info-filled",size:"14",color:"#F56C6C"}),d(o,null,{default:n((()=>[p(g(j.value),1)])),_:1})])),_:1})):f("",!0),d(C,{class:_(["register-button",{loading:U.value}]),onClick:B,disabled:U.value},{default:n((()=>[d(l,{class:"button-content"},{default:n((()=>[U.value?(u(),r(l,{key:0,class:"loading-spinner"})):f("",!0),d(o,null,{default:n((()=>[p(g(U.value?"注册中":"注册账号"),1)])),_:1})])),_:1})])),_:1},8,["disabled","class"]),d(l,{class:"agreement-text"},{default:n((()=>[d(T,{checked:q.agreeTerms,onClick:J,class:"checkbox",color:"#4CD964"},null,8,["checked"]),d(o,{onClick:J},{default:n((()=>[p("我已阅读并同意 "),d(o,{class:"link",onClick:k(W,["stop"])},{default:n((()=>[p("《用户协议》")])),_:1}),p("和"),d(o,{class:"link",onClick:k(X,["stop"])},{default:n((()=>[p("《隐私政策》")])),_:1})])),_:1})])),_:1}),$.terms?(u(),r(l,{key:1,class:"field-error"},{default:n((()=>[p(g($.terms),1)])),_:1})):f("",!0),d(l,{class:"extra-links"},{default:n((()=>[d(o,{onClick:E},{default:n((()=>[p("已有账号? 返回登录")])),_:1})])),_:1})])),_:1}),d(l,{class:"footer"},{default:n((()=>[d(o,null,{default:n((()=>[p("智慧租房平台 © 2023")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-82e25b36"]]);export{j as default};
