import{d as e,r as t,H as a,I as o,x as l,a as n,J as s,c as r,w as c,z as i,i as u,e as m,g as d,f as p,n as f,t as _,M as v,K as g,L as h,y,W as b}from"./index-BWYHzEly.js";import{g as I,b as P}from"./request.DW5hqJBG.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";const N=D(e({__name:"form",setup(e){const D=t(!0),N=t(!1),k=t(null),V=t(null),w=a((()=>{const e=new Date;return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`})),T=o({appointmentDate:"",appointmentTime:"",contactName:"",contactPhone:"",notes:""}),x=e=>{T.appointmentDate=e.detail.value},S=e=>{T.appointmentTime=e.detail.value},$=async()=>{if(!N.value)try{let t=!0,a="";if(T.appointmentDate?T.appointmentTime?T.contactName.trim()?T.contactPhone&&/^1[3-9]\d{9}$/.test(T.contactPhone)||(t=!1,a="请输入正确的手机号码"):(t=!1,a="请输入联系人姓名"):(t=!1,a="请选择看房时间"):(t=!1,a="请选择看房日期"),!t)return void n({title:a,icon:"none",duration:2e3});console.log("表单验证通过，准备提交"),N.value=!0;const o={property_id:k.value,viewing_date:T.appointmentDate,viewing_time:T.appointmentTime,contact_name:T.contactName,contact_phone:T.contactPhone,notes:T.notes};console.log("预约提交数据:",o);const l=await P("/appointments",o);if(console.log("预约API响应:",l),l&&(l.success||l.id)){try{const e={name:T.contactName,phone:T.contactPhone};b("userInfo",JSON.stringify(e))}catch(e){console.error("保存用户信息失败:",e)}n({title:"预约提交成功",icon:"success",duration:2e3}),setTimeout((()=>{s()}),1500)}else n({title:(null==l?void 0:l.message)||"预约失败，请稍后再试",icon:"none",duration:2e3})}catch(t){console.error("预约提交出错:",t),n({title:"提交失败，请重试",icon:"none",duration:2e3})}finally{N.value=!1}};return l((e=>{console.log("表单页面加载，接收到参数:",e),(null==e?void 0:e.propertyId)?(k.value=e.propertyId,(async e=>{D.value=!0,console.log(`获取房源ID: ${e} 的详情`);try{const t=await I(`/properties/public/${e}`);console.log("获取到房源信息:",t),t&&t.success&&t.property?V.value=t.property:t&&t.data?V.value=t.data:t&&"object"==typeof t?V.value=t:(console.error("无法识别的API响应格式:",t),n({title:"获取房源详情失败",icon:"none",duration:2e3}))}catch(t){console.error("获取房源详情失败:",t),n({title:"获取房源详情失败",icon:"none",duration:2e3})}finally{D.value=!1}})(e.propertyId),(()=>{try{const e=i("userInfo");if(e){const t="string"==typeof e?JSON.parse(e):e;T.contactName=t.name||t.nickname||"",T.contactPhone=t.phone||t.phoneNumber||t.mobile||""}}catch(e){console.error("加载用户信息失败:",e)}})()):(console.error("Property ID is missing for booking"),D.value=!1,n({title:"无法加载房源信息",icon:"error",duration:2e3}),setTimeout((()=>s()),1500))})),(e,t)=>{const a=u,o=f,l=v,n=g,s=h,i=y;return m(),r(a,{class:"booking-form-page"},{default:c((()=>[D.value?(m(),r(a,{key:0,class:"loading-placeholder"},{default:c((()=>[d("加载中...")])),_:1})):V.value?(m(),r(a,{key:2,class:"form-container"},{default:c((()=>[p(a,{class:"property-info-section"},{default:c((()=>[p(o,{class:"label"},{default:c((()=>[d("预约房源:")])),_:1}),p(o,{class:"value"},{default:c((()=>[d(_(V.value.title),1)])),_:1})])),_:1}),p(a,{class:"form-content"},{default:c((()=>[p(a,{class:"form-item"},{default:c((()=>[p(a,{class:"form-label required"},{default:c((()=>[d("看房日期")])),_:1}),p(l,{mode:"date",value:T.appointmentDate,start:w.value,onChange:x},{default:c((()=>[p(a,{class:"picker-view"},{default:c((()=>[d(_(T.appointmentDate||"请选择日期"),1)])),_:1})])),_:1},8,["value","start"])])),_:1}),p(a,{class:"form-item"},{default:c((()=>[p(a,{class:"form-label required"},{default:c((()=>[d("看房时间")])),_:1}),p(l,{mode:"time",value:T.appointmentTime,onChange:S},{default:c((()=>[p(a,{class:"picker-view"},{default:c((()=>[d(_(T.appointmentTime||"请选择时间"),1)])),_:1})])),_:1},8,["value"])])),_:1}),p(a,{class:"form-item"},{default:c((()=>[p(a,{class:"form-label required"},{default:c((()=>[d("联系人")])),_:1}),p(n,{type:"text",modelValue:T.contactName,"onUpdate:modelValue":t[0]||(t[0]=e=>T.contactName=e),placeholder:"请输入您的姓名",class:"form-input"},null,8,["modelValue"])])),_:1}),p(a,{class:"form-item"},{default:c((()=>[p(a,{class:"form-label required"},{default:c((()=>[d("手机号")])),_:1}),p(n,{type:"number",modelValue:T.contactPhone,"onUpdate:modelValue":t[1]||(t[1]=e=>T.contactPhone=e),placeholder:"请输入您的手机号",class:"form-input",maxlength:"11"},null,8,["modelValue"])])),_:1}),p(a,{class:"form-item"},{default:c((()=>[p(a,{class:"form-label"},{default:c((()=>[d("备注")])),_:1}),p(s,{modelValue:T.notes,"onUpdate:modelValue":t[2]||(t[2]=e=>T.notes=e),placeholder:"如有特殊要求请备注",class:"form-textarea"},null,8,["modelValue"])])),_:1})])),_:1}),p(i,{class:"submit-button",onClick:$,disabled:N.value},{default:c((()=>[d(_(N.value?"提交中...":"提交预约"),1)])),_:1},8,["disabled"])])),_:1})):(m(),r(a,{key:1,class:"error-placeholder"},{default:c((()=>[d("无法加载房源信息")])),_:1}))])),_:1})}}}),[["__scopeId","data-v-78b05372"]]);export{N as default};
