import{d as e,r as l,I as s,c as a,w as o,i as r,b as t,e as n,f as d,m as u,n as c,g as i,q as p,K as f,t as m,y as g,G as _,W as v,a as y,v as h,u as w}from"./index-BWYHzEly.js";import{_ as k}from"./landlord-logo.DjfpHVFB.js";import{b}from"./request.DW5hqJBG.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const C=x(e({__name:"login",setup(e){const x=l(!1),C=l(""),F=l(!1),I=s({username:"",password:""}),V=()=>{F.value=!F.value},j=async()=>{if(C.value="",I.username.trim())if(I.password.trim())try{x.value=!0,console.log("尝试房东登录:",I);try{const e=await b("/auth/login/password",{username:I.username,password:I.password});console.log("服务器响应:",e),e&&e.success&&e.token?(v("token",e.token),e.user&&v("userInfo",e.user),y({title:"登录成功",icon:"success"}),console.log("准备跳转到dashboard页面"),setTimeout((()=>{try{h({url:"/pages/landlord/dashboard",success(){console.log("跳转成功")},fail(e){console.error("跳转失败:",e),w({url:"/pages/landlord/dashboard"})}})}catch(e){console.error("跳转出错:",e)}}),1500)):(C.value=e.message||"登录失败，请检查用户名和密码",y({title:C.value,icon:"none"}))}catch(e){if(console.error("API请求失败:",e),"landlord"===I.username&&"password"===I.password){console.log("使用模拟登录 (API不可用)"),v("token","mock-token-for-development-only"),v("userInfo",{id:"1",username:I.username,role:"landlord"}),y({title:"(模拟)登录成功",icon:"success"}),console.log("准备跳转到dashboard页面(模拟)");try{h({url:"/pages/landlord/dashboard",success(){console.log("跳转成功(模拟)")},fail(e){console.error("跳转失败(模拟):",e),w({url:"/pages/landlord/dashboard"})}})}catch(l){console.error("跳转出错(模拟):",l)}}else C.value="服务器连接失败或用户名密码错误",y({title:C.value,icon:"none"})}}finally{x.value=!1}else C.value="请输入密码";else C.value="请输入用户名"},z=()=>{w({url:"/pages/landlord/register"})},q=()=>{y({title:"功能待实现",icon:"none"})};return(e,l)=>{const s=u,v=c,y=r,h=t("uni-icons"),w=f,b=g;return n(),a(y,{class:"landlord-login-page"},{default:o((()=>[d(y,{class:"login-header"},{default:o((()=>[d(s,{src:k,mode:"aspectFit",class:"logo"}),d(v,{class:"welcome-text"},{default:o((()=>[i("欢迎使用房东管理系统")])),_:1})])),_:1}),d(y,{class:"login-container"},{default:o((()=>[d(y,{class:"title"},{default:o((()=>[i("房东登录")])),_:1}),d(y,{class:"form-group"},{default:o((()=>[d(y,{class:"form-item"},{default:o((()=>[d(h,{type:"person",size:"20",color:"#409EFF"}),d(w,{type:"text",modelValue:I.username,"onUpdate:modelValue":l[0]||(l[0]=e=>I.username=e),placeholder:"请输入用户名/手机号",class:"input",focus:""},null,8,["modelValue"])])),_:1}),d(y,{class:"form-item"},{default:o((()=>[d(h,{type:"locked",size:"20",color:"#409EFF"}),d(w,{type:F.value?"text":"password",modelValue:I.password,"onUpdate:modelValue":l[1]||(l[1]=e=>I.password=e),placeholder:"请输入密码",class:"input"},null,8,["type","modelValue"]),d(y,{class:"password-toggle",onClick:V},{default:o((()=>[d(h,{type:F.value?"eye-filled":"eye-slash-filled",size:"20",color:"#909399"},null,8,["type"])])),_:1})])),_:1})])),_:1}),C.value?(n(),a(y,{key:0,class:"error-message"},{default:o((()=>[d(h,{type:"info-filled",size:"14",color:"#F56C6C"}),d(v,null,{default:o((()=>[i(m(C.value),1)])),_:1})])),_:1})):p("",!0),d(b,{class:_(["login-button",{loading:x.value}]),onClick:j,disabled:x.value||!I.username||!I.password},{default:o((()=>[d(y,{class:"button-content"},{default:o((()=>[x.value?(n(),a(y,{key:0,class:"loading-spinner"})):p("",!0),d(v,null,{default:o((()=>[i(m(x.value?"登录中":"登录"),1)])),_:1})])),_:1})])),_:1},8,["disabled","class"]),d(y,{class:"extra-links"},{default:o((()=>[d(v,{onClick:q},{default:o((()=>[i("忘记密码?")])),_:1}),d(v,{onClick:z},{default:o((()=>[i("注册账号")])),_:1})])),_:1})])),_:1}),d(y,{class:"footer"},{default:o((()=>[d(v,null,{default:o((()=>[i("智慧租房平台 © 2023")])),_:1})])),_:1})])),_:1})}}}),[["__scopeId","data-v-ad620de3"]]);export{C as default};
